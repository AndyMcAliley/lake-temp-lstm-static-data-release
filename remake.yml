packages:
  - tidyverse
  - meddle # at least v0.0.12
  - scipiper
  - readr
  - sbtools
  - sf

sources:
  - src/sb_utils.R
  - src/file_utils.R
  - src/prep_helpers.R

targets:
  all:
    depends:
      - log/sb_posted_files.csv
    
  lstm_site_ids:
    command: prep_site_ids('in_data/lake_metadata_lstm.csv')
  
  lake_locations_sf:
    command: prep_lake_locations(
      data_file = '../lake-temperature-model-prep/2_crosswalk_munge/out/centroid_lakes_sf.rds',
      lakes_in_release = lstm_site_ids)
  
  lake_locations_metadata:
    command: extract_feature(lake_locations_sf)
    
  out_data/cars.csv:
    command: file.copy(from = "example_data/example_cars.csv", 
      to = target_name, overwrite = TRUE)
  
  out_data/lake_locations.zip:
    command: sf_to_zip(zip_filename = target_name, 
      sf_object = lake_locations_sf, layer_name = I('lake_centroids'))

  out_xml/fgdc_metadata.xml:
    command: render(filename = target_name,
      "in_text/text_data_release.yml",
      spatial_metadata)
    
  log/sb_posted_files.csv:
    command: sb_replace_files_log(filename = target_name, 
      sb_id = I('5faaac68d34eb413d5df1f22'),
      "out_data/lake_locations.zip",
      "out_data/cars.csv",
      "out_xml/fgdc_metadata.xml",
      sources = "src/sb_utils.R")
      
